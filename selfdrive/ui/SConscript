Import('env', 'arch', 'common', 'messaging', 'gpucommon', 'visionipc', 'cereal')
lenv = env.Clone()
common_src = ['uicommon.cc', '#phonelibs/nanovg/nanovg.c']

ui_src = ['ui.cc', 'paint.cc', 'sidebar.cc']
libs = [common, 'zmq', 'czmq', 'capnp', 'kj', 'm', cereal, messaging, gpucommon, visionipc]
if arch == "aarch64":
  ui_src += ['sound.cc']
  libs += ['EGL', 'GLESv3', 'gnustl_shared', 'log', 'utils', 'gui', 'hardware', 'ui', 'CB', 'gsl', 'adreno_utils', 'OpenSLES', 'cutils', 'uuid', 'OpenCL']
  linkflags = ['-Wl,-rpath=/system/lib64,-rpath=/system/comma/usr/lib']
else:
  common_src += ['linux.cc']
  libs += ['pthread', 'glfw']
  linkflags = []

common = lenv.Object(common_src)

lenv.Program('_ui', ui_src+common, LINKFLAGS=linkflags, LIBS=libs)
lenv.Program('_driverview', ['driverview.cc']+common, LINKFLAGS=linkflags, LIBS=libs)
