Import('env', 'cython_dependencies', 'arch')

# d = Dir('.')

# env.Command(['transformations.so'],
#             cython_dependencies + ['transformations.pxd', 'transformations.pyx',
#              'coordinates.cc', 'orientation.cc', 'coordinates.hpp', 'orientation.hpp'],
#             'cd ' + d.path + ' && python3 setup.py build_ext --inplace')


envB = env.Clone()
envB["CCFLAGS"].remove("-Werror")

added_libs = []
if arch == "Darwin":
  envB["LINKFLAGS"]=["-bundle", "-undefined", "dynamic_lookup"]
elif arch == "aarch64":
  envB["LINKFLAGS"]=["-shared"]

  Import("python_path")
  added_libs.append(python_path.split("/")[-1])
else:
  envB["LINKFLAGS"]=["-pthread", "-shared"]


envB.Cython('transformations.cpp', 'transformations.pyx')

envB.Program('transformations.so', 'transformations.cpp', LIBS=[] + added_libs)
